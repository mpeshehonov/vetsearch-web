-- Финальный SQL скрипт с правильными названиями колонок
-- Очищаем существующие данные (кроме городов)
DELETE FROM reviews;
DELETE FROM medical_records;
DELETE FROM appointments;
DELETE FROM pets;
DELETE FROM pet_owners;
DELETE FROM clinic_services;
DELETE FROM clinic_veterinarians;
DELETE FROM profiles;
DELETE FROM clinics;
DELETE FROM services;

-- 1. Создаем услуги
INSERT INTO services (id, name, description, price, duration_minutes, category, is_active, created_at) VALUES
('550e8400-e29b-41d4-a716-446655440001', 'Общий осмотр', 'Комплексный осмотр животного с консультацией ветеринара', 1500.00, 30, 'Консультации', true, NOW()),
('550e8400-e29b-41d4-a716-446655440002', 'Вакцинация', 'Профилактическая вакцинация животных', 2000.00, 20, 'Профилактика', true, NOW()),
('550e8400-e29b-41d4-a716-446655440003', 'Стерилизация кошек', 'Хирургическая стерилизация кошек', 8000.00, 90, 'Хирургия', true, NOW()),
('550e8400-e29b-41d4-a716-446655440004', 'Кастрация котов', 'Хирургическая кастрация котов', 6000.00, 60, 'Хирургия', true, NOW()),
('550e8400-e29b-41d4-a716-446655440005', 'УЗИ диагностика', 'Ультразвуковое исследование внутренних органов', 3000.00, 45, 'Диагностика', true, NOW()),
('550e8400-e29b-41d4-a716-446655440006', 'Рентген', 'Рентгенологическое исследование', 2500.00, 30, 'Диагностика', true, NOW()),
('550e8400-e29b-41d4-a716-446655440007', 'Анализ крови', 'Общий и биохимический анализ крови', 1800.00, 15, 'Лабораторные исследования', true, NOW()),
('550e8400-e29b-41d4-a716-446655440008', 'Чистка зубов', 'Профессиональная чистка зубов животных', 4000.00, 60, 'Стоматология', true, NOW());

-- 2. Создаем клиники (используя существующие города)
INSERT INTO clinics (id, name, description, address, phone, email, website, city_id, latitude, longitude, rating, reviews_count, working_hours, is_active, created_at, updated_at) VALUES
('660e8400-e29b-41d4-a716-446655440001', 'ВетКлиника "Здоровый питомец"', 'Современная ветеринарная клиника с полным спектром услуг', 'ул. Ленина, 15', '+7 (495) 123-45-67', 'info@healthypet.ru', 'https://healthypet.ru', (SELECT id FROM cities WHERE name = 'Москва' LIMIT 1), 55.7558, 37.6176, 4.8, 156, '{"monday": "09:00-21:00", "tuesday": "09:00-21:00", "wednesday": "09:00-21:00", "thursday": "09:00-21:00", "friday": "09:00-21:00", "saturday": "10:00-18:00", "sunday": "10:00-18:00"}', true, NOW(), NOW()),
('660e8400-e29b-41d4-a716-446655440002', 'Ветеринарный центр "Айболит"', 'Круглосуточная ветеринарная помощь', 'пр. Невский, 88', '+7 (812) 987-65-43', 'help@aibolit-vet.ru', 'https://aibolit-vet.ru', (SELECT id FROM cities WHERE name = 'Санкт-Петербург' LIMIT 1), 59.9311, 30.3609, 4.6, 203, '{"monday": "00:00-23:59", "tuesday": "00:00-23:59", "wednesday": "00:00-23:59", "thursday": "00:00-23:59", "friday": "00:00-23:59", "saturday": "00:00-23:59", "sunday": "00:00-23:59"}', true, NOW(), NOW()),
('660e8400-e29b-41d4-a716-446655440003', 'Клиника "Четыре лапы"', 'Семейная ветеринарная клиника', 'ул. Красная, 42', '+7 (861) 555-77-99', 'info@4paws.ru', 'https://4paws.ru', (SELECT id FROM cities WHERE name = 'Краснодар' LIMIT 1), 45.0355, 38.9753, 4.7, 89, '{"monday": "08:00-20:00", "tuesday": "08:00-20:00", "wednesday": "08:00-20:00", "thursday": "08:00-20:00", "friday": "08:00-20:00", "saturday": "09:00-17:00", "sunday": "09:00-17:00"}', true, NOW(), NOW());

-- 3. Создаем профили ветеринаров
INSERT INTO profiles (id, full_name, email, phone, role, specialization, license_number, is_active, created_at, updated_at) VALUES
('770e8400-e29b-41d4-a716-446655440001', 'Иванова Анна Сергеевна', 'ivanova@healthypet.ru', '+7 (495) 123-45-67', 'veterinarian', 'Терапевт', 'VET-2019-001234', true, NOW(), NOW()),
('770e8400-e29b-41d4-a716-446655440002', 'Петров Михаил Александрович', 'petrov@healthypet.ru', '+7 (495) 123-45-68', 'veterinarian', 'Хирург', 'VET-2018-005678', true, NOW(), NOW()),
('770e8400-e29b-41d4-a716-446655440003', 'Сидорова Елена Викторовна', 'sidorova@aibolit-vet.ru', '+7 (812) 987-65-44', 'veterinarian', 'Дерматолог', 'VET-2020-009876', true, NOW(), NOW()),
('770e8400-e29b-41d4-a716-446655440004', 'Козлов Дмитрий Иванович', 'kozlov@aibolit-vet.ru', '+7 (812) 987-65-45', 'veterinarian', 'Кардиолог', 'VET-2017-004321', true, NOW(), NOW()),
('770e8400-e29b-41d4-a716-446655440005', 'Морозова Ольга Петровна', 'morozova@4paws.ru', '+7 (861) 555-77-98', 'veterinarian', 'Офтальмолог', 'VET-2021-007890', true, NOW(), NOW());

-- 4. Связываем ветеринаров с клиниками
INSERT INTO clinic_veterinarians (id, clinic_id, veterinarian_id, is_primary, created_at) VALUES
('880e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440001', true, NOW()),
('880e8400-e29b-41d4-a716-446655440002', '660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440002', false, NOW()),
('880e8400-e29b-41d4-a716-446655440003', '660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440003', true, NOW()),
('880e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440004', false, NOW()),
('880e8400-e29b-41d4-a716-446655440005', '660e8400-e29b-41d4-a716-446655440003', '770e8400-e29b-41d4-a716-446655440005', true, NOW());

-- 5. Связываем клиники с услугами
INSERT INTO clinic_services (id, clinic_id, service_id, price, is_available, created_at) VALUES
-- Клиника "Здоровый питомец"
('990e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440001', 1500.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440002', '660e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440002', 2000.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440003', '660e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440003', 8000.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440005', 3000.00, true, NOW()),
-- Клиника "Айболит"
('990e8400-e29b-41d4-a716-446655440005', '660e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440001', 1600.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440006', '660e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440006', 2500.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440007', '660e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440007', 1800.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440008', '660e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440008', 4000.00, true, NOW()),
-- Клиника "Четыре лапы"
('990e8400-e29b-41d4-a716-446655440009', '660e8400-e29b-41d4-a716-446655440003', '550e8400-e29b-41d4-a716-446655440001', 1400.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440010', '660e8400-e29b-41d4-a716-446655440003', '550e8400-e29b-41d4-a716-446655440004', 6000.00, true, NOW()),
('990e8400-e29b-41d4-a716-446655440011', '660e8400-e29b-41d4-a716-446655440003', '550e8400-e29b-41d4-a716-446655440005', 2800.00, true, NOW());

-- 6. Создаем владельцев животных
INSERT INTO pet_owners (id, full_name, email, phone, address, emergency_contact, notes, created_at, updated_at) VALUES
('aa0e8400-e29b-41d4-a716-446655440001', 'Смирнов Алексей Владимирович', 'smirnov@email.ru', '+7 (495) 111-22-33', 'г. Москва, ул. Тверская, 10, кв. 25', '+7 (495) 111-22-34', 'Предпочитает утренние приемы', NOW(), NOW()),
('aa0e8400-e29b-41d4-a716-446655440002', 'Кузнецова Мария Ивановна', 'kuznetsova@email.ru', '+7 (812) 222-33-44', 'г. Санкт-Петербург, пр. Московский, 15, кв. 8', '+7 (812) 222-33-45', 'Животное боится громких звуков', NOW(), NOW()),
('aa0e8400-e29b-41d4-a716-446655440003', 'Попов Сергей Николаевич', 'popov@email.ru', '+7 (861) 333-44-55', 'г. Краснодар, ул. Красная, 100, кв. 12', '+7 (861) 333-44-56', 'Регулярный клиент', NOW(), NOW());

-- 7. Создаем животных
INSERT INTO pets (id, name, species, breed, gender, birth_date, weight, color, microchip_number, allergies, medical_notes, owner_id, is_active, created_at, updated_at) VALUES
('bb0e8400-e29b-41d4-a716-446655440001', 'Мурка', 'Кошка', 'Британская короткошерстная', 'Женский', '2020-03-15', 4.2, 'Серый', '123456789012345', 'Нет', 'Стерилизована в 2021 году', 'aa0e8400-e29b-41d4-a716-446655440001', true, NOW(), NOW()),
('bb0e8400-e29b-41d4-a716-446655440002', 'Барсик', 'Кот', 'Мейн-кун', 'Мужской', '2019-07-22', 6.8, 'Рыжий', '234567890123456', 'Курица', 'Кастрирован, склонен к мочекаменной болезни', 'aa0e8400-e29b-41d4-a716-446655440002', true, NOW(), NOW()),
('bb0e8400-e29b-41d4-a716-446655440003', 'Рекс', 'Собака', 'Немецкая овчарка', 'Мужской', '2018-11-10', 32.5, 'Черно-коричневый', '345678901234567', 'Нет', 'Активная собака, требует регулярных нагрузок', 'aa0e8400-e29b-41d4-a716-446655440003', true, NOW(), NOW());

-- 8. Создаем записи на прием
INSERT INTO appointments (id, pet_id, veterinarian_id, service_id, appointment_date, appointment_time, duration_minutes, status, reason, diagnosis, treatment, notes, follow_up_needed, follow_up_date, total_cost, created_at, updated_at) VALUES
('cc0e8400-e29b-41d4-a716-446655440001', 'bb0e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440001', '2024-01-15', '10:00:00', 30, 'Завершен', 'Плановый осмотр', 'Здорова', 'Рекомендована профилактика', 'Животное спокойное', false, NULL, 1500.00, NOW(), NOW()),
('cc0e8400-e29b-41d4-a716-446655440002', 'bb0e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440003', '550e8400-e29b-41d4-a716-446655440007', '2024-01-20', '14:30:00', 15, 'Завершен', 'Анализ крови', 'Легкая анемия', 'Назначены витамины', 'Повторный анализ через месяц', true, '2024-02-20', 1800.00, NOW(), NOW()),
('cc0e8400-e29b-41d4-a716-446655440003', 'bb0e8400-e29b-41d4-a716-446655440003', '770e8400-e29b-41d4-a716-446655440005', '550e8400-e29b-41d4-a716-446655440001', '2024-02-01', '16:00:00', 30, 'Запланирован', 'Консультация офтальмолога', NULL, NULL, 'Подозрение на катаракту', false, NULL, 1400.00, NOW(), NOW());

-- 9. Создаем отзывы
INSERT INTO reviews (id, clinic_id, veterinarian_id, author_name, author_email, title, content, rating, is_verified, is_helpful_count, created_at, updated_at) VALUES
('dd0e8400-e29b-41d4-a716-446655440001', '660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440001', 'Алексей С.', 'smirnov@email.ru', 'Отличный ветеринар!', 'Доктор Иванова очень внимательно осмотрела мою кошку, дала подробные рекомендации. Клиника современная, персонал вежливый. Обязательно вернемся!', 5, true, 12, NOW(), NOW()),
('dd0e8400-e29b-41d4-a716-446655440002', '660e8400-e29b-41d4-a716-446655440001', '770e8400-e29b-41d4-a716-446655440002', 'Мария К.', 'kuznetsova@email.ru', 'Профессиональная хирургия', 'Доктор Петров провел стерилизацию моей кошки. Операция прошла отлично, восстановление быстрое. Спасибо за профессионализм!', 5, true, 8, NOW(), NOW()),
('dd0e8400-e29b-41d4-a716-446655440003', '660e8400-e29b-41d4-a716-446655440002', '770e8400-e29b-41d4-a716-446655440003', 'Сергей П.', 'popov@email.ru', 'Хорошая клиника', 'Круглосуточная работа - это большой плюс. Доктор Сидорова помогла с кожной проблемой у собаки. Цены адекватные.', 4, true, 5, NOW(), NOW()),
('dd0e8400-e29b-41d4-a716-446655440004', '660e8400-e29b-41d4-a716-446655440003', '770e8400-e29b-41d4-a716-446655440005', 'Анна В.', 'anna.v@email.ru', 'Отличный офтальмолог', 'Доктор Морозова очень внимательно осмотрела глаза моего кота, объяснила все доступно. Рекомендую!', 5, true, 3, NOW(), NOW());

-- Обновляем счетчики отзывов в клиниках (это должно происходить автоматически через триггеры, но на всякий случай)
UPDATE clinics SET reviews_count = (
    SELECT COUNT(*) FROM reviews WHERE reviews.clinic_id = clinics.id
);

-- Обновляем рейтинги клиник
UPDATE clinics SET rating = (
    SELECT ROUND(AVG(rating::numeric), 1) FROM reviews WHERE reviews.clinic_id = clinics.id
);
